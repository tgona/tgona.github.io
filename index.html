<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>HTML DOM - Drag and drop table row</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="/assets/css/demo.css" />
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&display=swap">
    <style>
        .table {
            border: 1px solid #ccc;
            border-collapse: collapse;
        }
        .table th,
        .table td {
            border: 1px solid #ccc;
        }
        .table th,
        .table td {
            padding: 0.5rem;
        }
        .draggable {
            cursor: move;
            user-select: none;
        }
        .placeholder {
            background-color: #edf2f7;
            border: 2px dashed #cbd5e0;
        }
        .clone-list {
            border-top: 1px solid #ccc;
        }
        .clone-table {
            border-collapse: collapse;
            border: none;
        }
        .clone-table th,
        .clone-table td {
            border: 1px solid #ccc;
            border-top: none;
            padding: 0.5rem;
        }
        .dragging {
            background: #fff;
            border-top: 1px solid #ccc;
            z-index: 999;
        }
        .ranking-column {
            position: sticky;
            left: 0;
            background-color: #f8f8f8;
            z-index: 99;
        }
    </style>
</head>
<body>
<div style="padding: 4rem 0">
    <table id="table" class="table">
        <thead>
        <tr>
            <th class="ranking-column"></th>
            <th data-type="number">No.</th>
            <th>First name</th>
            <th>Last name</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td class="ranking-column">1</td>
            <td>1</td>
            <td>Andrea</td>
            <td>Ross</td>
        </tr>
        <tr>
            <td class="ranking-column">2</td>
            <td>2</td>
            <td>Penelope</td>
            <td>Mills</td>
        </tr>
        <tr>
            <td class="ranking-column">3</td>
            <td>3</td>
            <td>Sarah</td>
            <td>Grant</td>
        </tr>
        <tr>
            <td class="ranking-column">4</td>
            <td>4</td>
            <td>Vanessa</td>
            <td>Roberts</td>
        </tr>
        <tr>
            <td class="ranking-column">5</td>
            <td>5</td>
            <td>Oliver</td>
            <td>Alsop</td>
        </tr>
        <tr>
            <td class="ranking-column">6</td>
            <td>6</td>
            <td>Jennifer</td>
            <td>Forsyth</td>
        </tr>
        </tbody>
    </table>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const table = document.getElementById("table");
        const rows = table.getElementsByTagName("tr");
        const rankingColumn = table.getElementsByClassName("ranking-column")[0];

        let dragSrcIndex = null;
        let dragStartY = null;
        let dragCurrentY = null;
        let cloneTable = null;

        for (let i = 0; i < rows.length; i++) {
            const row = rows[i];
            row.addEventListener("mousedown", mouseDownHandler);
        }

        function mouseDownHandler(event) {
            if (event.target === rankingColumn) return;
            event.preventDefault();

            const row = event.target.parentNode;
            dragSrcIndex = row.rowIndex;
            dragStartY = event.clientY;

            document.addEventListener("mousemove", mouseMoveHandler);
            document.addEventListener("mouseup", mouseUpHandler);
        }

        function mouseMoveHandler(event) {
            event.preventDefault();

            const row = rows[dragSrcIndex];
            const offset = event.clientY - dragStartY;
            const currentY = dragSrcIndex + Math.round(offset / row.offsetHeight);

            if (currentY !== dragCurrentY) {
                dragCurrentY = currentY;

                const cloneTable = createCloneTable();
                const placeholder = createPlaceholder(row);

                if (currentY > dragSrcIndex) {
                    table.insertBefore(placeholder, rows[currentY + 1]);
                } else {
                    table.insertBefore(placeholder, rows[currentY]);
                }

                table.style.display = "none";
                document.body.appendChild(cloneTable);
            }

            const draggingRow = rows[dragSrcIndex];
            draggingRow.style.transform = `translateY(${offset}px)`;
        }

        function mouseUpHandler(event) {
            event.preventDefault();

            const row = rows[dragSrcIndex];
            const placeholder = table.getElementsByClassName("placeholder")[0];
            const targetIndex = placeholder ? placeholder.rowIndex : rows.length;

            table.insertBefore(row, rows[targetIndex]);

            row.style.transform = "";
            table.style.display = "";
            document.body.removeChild(cloneTable);
            removePlaceholder();

            document.removeEventListener("mousemove", mouseMoveHandler);
            document.removeEventListener("mouseup", mouseUpHandler);
        }

        function createCloneTable() {
            const cloneList = document.createElement("div");
            cloneList.classList.add("clone-list");

            cloneTable = document.createElement("table");
            cloneTable.classList.add("clone-table");

            for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                const cloneRow = row.cloneNode(true);
                cloneTable.appendChild(cloneRow);
            }

            cloneList.appendChild(cloneTable);
            return cloneList;
        }

        function createPlaceholder(row) {
            const placeholder = document.createElement("tr");
            placeholder.classList.add("placeholder");
            placeholder.style.height = row.offsetHeight + "px";
            return placeholder;
        }

        function removePlaceholder() {
            const placeholder = table.getElementsByClassName("placeholder")[0];
            if (placeholder) {
                placeholder.parentNode.removeChild(placeholder);
            }
        }
    });
</script>
</body>
</html>
